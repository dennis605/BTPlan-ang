<div class="container">
  <h2>Therapien</h2>
  
  <button mat-raised-button color="primary" (click)="addTherapy()" class="add-button">
    <mat-icon>add</mat-icon>
    Therapie hinzufügen
  </button>

  <table mat-table [dataSource]="therapies" class="mat-elevation-z8">
    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Programm</th>
      <td mat-cell *matCellDef="let therapy">{{therapy.name}}</td>
    </ng-container>

    <!-- Leading Employee Column -->
    <ng-container matColumnDef="leadingEmployee">
      <th mat-header-cell *matHeaderCellDef>Mitarbeiter</th>
      <td mat-cell *matCellDef="let therapy">
        {{therapy.leadingEmployee.name}} {{therapy.leadingEmployee.surname}}
      </td>
    </ng-container>

    <!-- Patients Column -->
    <ng-container matColumnDef="patients">
      <th mat-header-cell *matHeaderCellDef>Bewohner</th>
      <td mat-cell *matCellDef="let therapy">
        <mat-chip-set>
          <mat-chip *ngFor="let patient of therapy.patients">
            {{patient.name}} {{patient.surname}}
          </mat-chip>
        </mat-chip-set>
      </td>
    </ng-container>

    <!-- Location Column -->
    <ng-container matColumnDef="location">
      <th mat-header-cell *matHeaderCellDef>Ort</th>
      <td mat-cell *matCellDef="let therapy">{{therapy.location.name}}</td>
    </ng-container>

    <!-- Time Column -->
    <ng-container matColumnDef="time">
      <th mat-header-cell *matHeaderCellDef>Datum & Zeit</th>
      <td mat-cell *matCellDef="let therapy">
        {{formatDate(therapy.startTime)}} {{formatTime(therapy.startTime)}} - {{formatTime(therapy.endTime)}}
      </td>
    </ng-container>

    <!-- Preparation Time Column -->
    <ng-container matColumnDef="preparationTime">
      <th mat-header-cell *matHeaderCellDef>Vorbereitungszeit</th>
      <td mat-cell *matCellDef="let therapy">{{therapy.preparationTime}} Min.</td>
    </ng-container>

    <!-- Follow Up Time Column -->
    <ng-container matColumnDef="followUpTime">
      <th mat-header-cell *matHeaderCellDef>Nachbereitungszeit</th>
      <td mat-cell *matCellDef="let therapy">{{therapy.followUpTime}} Min.</td>
    </ng-container>

    <!-- Comment Column -->
    <ng-container matColumnDef="comment">
      <th mat-header-cell *matHeaderCellDef>Kommentar</th>
      <td mat-cell *matCellDef="let therapy">{{therapy.comment || ''}}</td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Aktionen</th>
      <td mat-cell *matCellDef="let therapy">
        <button mat-icon-button color="primary" (click)="editTherapy(therapy)" matTooltip="Bearbeiten">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="accent" (click)="duplicateTherapy(therapy)" matTooltip="Duplizieren">
          <mat-icon>content_copy</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deleteTherapy(therapy.id!)" matTooltip="Löschen">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
